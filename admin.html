<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Veltra â€” Admin Panel</title>
<style>
:root{
  --bg:#000; --text:#fff; --muted:rgba(255,255,255,0.65);
  --border:rgba(255,255,255,0.12); --glow:rgba(255,255,255,0.12);
  --accent:#9be6a7;
}
body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif;}
.container{max-width:1100px;margin:18px auto;padding:14px;}
h1{font-size:24px;margin-bottom:16px;}
input,textarea,select,button{padding:8px;border-radius:6px;border:1px solid var(--border);background:transparent;color:#fff;width:100%;margin-bottom:8px;}
button{cursor:pointer;background:var(--accent);color:#000;border:none;}
.bookmark-list{margin-top:24px;}
.bookmark-item{border:1px solid var(--border);padding:12px;margin-bottom:12px;border-radius:8px;}
.actions{display:flex;gap:8px;margin-top:8px;}
.actions button{flex:1;}
.small{font-size:13px;color:var(--muted);}
</style>
</head>
<body>
<div class="container">
  <h1>Veltra Admin Panel</h1>

  <div>
    <h2>Add / Edit Bookmark</h2>
    <input id="titleInput" placeholder="Title">
    <textarea id="descInput" placeholder="Description"></textarea>
    <input id="codeInput" placeholder="Bookmarklet code (JS)">
    <input id="urlInput" placeholder="URL (optional)">
    <input id="creditsInput" placeholder="Credits Link (source of code)">
    <input id="categoriesInput" placeholder="Categories (comma separated)">
    <button id="saveBookmarkBtn">Save Bookmark</button>
    <p id="saveMsg" class="small"></p>
  </div>

  <div class="bookmark-list" id="bookmarkList"></div>
</div>

<script type="module">
import { app, db } from './firebase-config.js';
import { ref, get, set, push, update } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

const titleInput = document.getElementById('titleInput');
const descInput = document.getElementById('descInput');
const codeInput = document.getElementById('codeInput');
const urlInput = document.getElementById('urlInput');
const creditsInput = document.getElementById('creditsInput');
const categoriesInput = document.getElementById('categoriesInput');
const saveBookmarkBtn = document.getElementById('saveBookmarkBtn');
const saveMsg = document.getElementById('saveMsg');
const bookmarkList = document.getElementById('bookmarkList');

let bookmarks = {};
let editingId = null;

async function loadBookmarks(){
  const snap = await get(ref(db, 'bookmarks'));
  bookmarks = snap.exists() ? snap.val() : {};
  renderBookmarks();
}

function renderBookmarks(){
  bookmarkList.innerHTML = '';
  Object.entries(bookmarks).forEach(([id,b])=>{
    const div = document.createElement('div');
    div.className = 'bookmark-item';
    div.innerHTML = `
      <strong>${b.title || 'Untitled'}</strong> <span class="small">ID: ${id}</span><br>
      ${b.desc || ''}<br>
      <span class="small">Code: ${b.code || ''}</span><br>
      <span class="small">URL: ${b.url || ''}</span><br>
      <span class="small">Credits: <a href="${b.creditsLink||'#'}" target="_blank">${b.creditsLink||'N/A'}</a></span><br>
      <span class="small">Categories: ${b.categories ? Object.values(b.categories).join(', ') : ''}</span>
      <div class="actions">
        <button onclick="editBookmark('${id}')">Edit</button>
        <button onclick="deleteBookmark('${id}')">Delete</button>
      </div>
    `;
    bookmarkList.appendChild(div);
  });
}

window.editBookmark = function(id){
  const b = bookmarks[id];
  if(!b) return;
  editingId = id;
  titleInput.value = b.title || '';
  descInput.value = b.desc || '';
  codeInput.value = b.code || '';
  urlInput.value = b.url || '';
  creditsInput.value = b.creditsLink || '';
  categoriesInput.value = b.categories ? Object.values(b.categories).join(',') : '';
  saveMsg.textContent = 'Editing bookmark ' + id;
}

window.deleteBookmark = async function(id){
  if(!confirm('Delete this bookmark?')) return;
  await set(ref(db, 'bookmarks/' + id), null);
  await loadBookmarks();
}

saveBookmarkBtn.addEventListener('click', async ()=>{
  const title = titleInput.value.trim();
  const desc = descInput.value.trim();
  const code = codeInput.value.trim();
  const url = urlInput.value.trim();
  const creditsLink = creditsInput.value.trim();
  const categoriesArr = categoriesInput.value.split(',').map(s=>s.trim()).filter(Boolean);

  if(!title || !code){
    saveMsg.textContent = 'Title and code are required.';
    return;
  }

  const data = {
    title,
    desc,
    code,
    url,
    creditsLink,
    categories: categoriesArr.reduce((acc,c,i)=>{ acc[i]=c; return acc; }, {})
  };

  if(editingId){
    await update(ref(db, 'bookmarks/' + editingId), data);
    saveMsg.textContent = 'Bookmark updated.';
    editingId = null;
  } else {
    const newRef = push(ref(db, 'bookmarks'));
    await set(newRef, data);
    saveMsg.textContent = 'Bookmark added.';
  }

  titleInput.value=''; descInput.value=''; codeInput.value=''; urlInput.value=''; creditsInput.value=''; categoriesInput.value='';
  await loadBookmarks();
});

loadBookmarks();
</script>
</body>
</html>

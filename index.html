<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Veltra</title>
<style>
:root{
  --bg:#000; --text:#fff; --muted:rgba(255,255,255,0.65);
  --border:rgba(255,255,255,0.12); --glow:rgba(255,255,255,0.12);
  --card-bg:rgba(255,255,255,0.02);
}
html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--text);font-family:Inter,sans-serif;}
a{color:var(--text);text-decoration:underline;}
.container{max-width:1100px;margin:18px auto;padding:14px;}
.header{display:flex;align-items:center;gap:12px;padding:8px 0;position:relative;z-index:2;}
.logo{width:48px;height:48px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .8s ease;}
.logo.visible{opacity:1;}
.logo img{width:100%;height:100%;object-fit:contain;}
.title{font-size:20px;font-weight:600;}
.tag{color:var(--muted);font-size:13px;margin-top:2px;}
.controls{margin-left:auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.search,.btn{background:transparent;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;}
.search::placeholder{color:var(--muted);}
.search:focus,.btn:focus{outline:none;box-shadow:0 0 8px var(--glow);}
.top-controls{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-top:10px;flex-wrap:wrap;}
.filter-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.small{font-size:13px;color:var(--muted);}
.cat-chips{display:flex;gap:8px;flex-wrap:wrap;}
.cat-chip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);cursor:pointer;background:transparent;color:var(--text);font-size:13px;}
.cat-chip.selected{box-shadow:0 0 8px var(--glow);transform:translateY(-2px);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin-top:14px;}
.card{border:1px solid var(--border);padding:12px;border-radius:10px;background:var(--card-bg);transition: transform .18s ease, box-shadow .18s ease;}
.card:hover{transform: translateY(-6px) scale(1.01);box-shadow:0 10px 30px var(--glow);}
.card-head{display:flex;justify-content:space-between;align-items:center;gap:8px;}
.titleSmall{font-weight:600;}
.catTag{font-size:12px;padding:6px;border-radius:8px;border:1px solid var(--border);color:var(--text);background:transparent;}
.desc{color:var(--muted);font-size:13px;margin:8px 0;min-height:38px;}
.actions{display:flex;gap:8px;align-items:center;}
.copy-square{width:44px;height:44px;border-radius:8px;border:1px solid var(--border);display:inline-flex;align-items:center;justify-content:center;cursor:pointer;background:transparent;color:var(--text);font-weight:700;font-size:20px;}
.copy-square img{width:20px;height:20px;display:block;}
.copy-square:hover{box-shadow:0 0 10px var(--glow);transform:translateY(-2px);}
.toast{position:fixed;left:50%;transform:translateX(-50%);top:14px;padding:12px 18px;border-radius:999px;background:#000;color:#fff;box-shadow:0 10px 30px rgba(255,255,255,0.12);z-index:999;opacity:0;pointer-events:none;transition:opacity 0.3s;}
.toast.show{opacity:1;}
#lockBtn{position:fixed;top:16px;right:16px;width:40px;height:40px;border-radius:8px;padding:6px;border:1px solid var(--border);background:transparent;cursor:pointer;opacity:0.8;z-index:1000;transition:transform 0.2s,opacity 0.2s;}
#lockBtn img{width:100%;height:100%;display:block;}
#lockBtn:hover{transform:scale(1.2);opacity:1;}
#instructionsOverlay{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.95); color:#fff;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:2000; padding:40px; overflow:auto;
  opacity:0; pointer-events:none; transition:opacity 0.3s ease;
}
#instructionsOverlay.show { opacity:1; pointer-events:auto; }
#instructionsOverlay .content{max-width:800px; text-align:left; font-size:18px; }
#instructionsOverlay .backBtn{margin-top:20px;padding:10px 16px;font-size:16px;border:1px solid var(--border);background:transparent;color:#fff;border-radius:8px;cursor:pointer;}
.placeholder{text-align:center;padding:40px;color:var(--muted);grid-column:1/-1;border-radius:12px;border:1px solid rgba(255,255,255,0.02);}
.adminOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:3000;padding:20px;opacity:0;pointer-events:none;transition:opacity 0.3s;
}
.adminOverlay.show{opacity:1;pointer-events:auto;}
.adminOverlay input{margin:6px 0;padding:10px;border-radius:6px;border:1px solid var(--border);background:transparent;color:#fff;width:250px;}
.adminOverlay button{margin-top:12px;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:transparent;color:#fff;cursor:pointer;}
@media (max-width:1024px){
  .grid{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;}
  .controls{flex-direction:column;gap:8px;align-items:stretch;}
  .search{min-width:100%;}
  .copy-square{width:60px;height:60px;font-size:24px;}
}
</style>
</head>
<body>

<!-- TOS overlay -->
<div id="tosOverlay" class="tos-overlay" role="dialog" aria-modal="true">
  <div class="tos-content">
    <div class="tos-header" style="text-align:center;margin-bottom:12px;">
      <div style="display:flex;align-items:center;justify-content:center;gap:12px;">
        <div style="width:56px;height:56px;border-radius:10px;overflow:hidden;">
          <img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/77582cdf6ca35abff9636d884eadb3112e5c5269/black-and-white-geometric-logos-1%20(1).png" alt="logo" style="width:100%;height:100%;object-fit:contain;">
        </div>
        <h2 class="glow-header" style="margin:0">Veltra — Terms of Service & Privacy Policy</h2>
      </div>
      <p style="color:var(--muted);margin-top:8px"><strong>Last updated: October 28, 2025</strong></p>
    </div>
    <p>Welcome to Veltra. By using this site you agree to these Terms and our Privacy Policy.</p>
    <div style="text-align:center;margin-top:14px">
      <button id="acceptTOS">I Accept</button>
    </div>
  </div>
</div>

<!-- Main container -->
<div class="container" id="appContent" aria-hidden="true">
  <div class="header">
    <div class="logo" id="headerLogoContainer"><img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/77582cdf6ca35abff9636d884eadb3112e5c5269/black-and-white-geometric-logos-1%20(1).png" alt="Veltra Logo"></div>
    <div>
      <div class="title">Veltra</div>
      <div class="tag">Bookmarks & bookmarklets — clean & quick</div>
    </div>
    <div class="controls">
      <input id="search" class="search" placeholder="Search... (press Enter)">
      <button id="instructionsBtn" class="btn">Instructions</button>
    </div>
  </div>

  <div class="top-controls">
    <div class="filter-row">
      <div class="small">Filter categories:</div>
      <div id="catChips" class="cat-chips"></div>
    </div>
    <div class="controls-row">
      <div class="small">Selected: <span id="activeCount">All</span></div>
      <button id="clearCats" class="btn">Clear</button>
    </div>
  </div>

  <div id="grid" class="grid" aria-live="polite"></div>
  <div id="placeholder" class="placeholder" style="display:none">No bookmarks match. Try another filter.</div>
</div>

<button id="lockBtn" title="Admin">
  <img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/4aca40ab959224fb756c3d04fe34f266d635f477/lock-icon-clipart-free-png%20(1).webp" alt="Admin Lock">
</button>

<div id="toast" class="toast"><span id="toastText"></span></div>

<!-- Instructions overlay -->
<div id="instructionsOverlay">
  <div class="content">
    <h2>Instructions</h2>
    <p>Click the copy button on any card to copy the bookmarklet code. Use the filter chips and search to find items fast.</p>
  </div>
  <button class="backBtn" id="closeInstructions">Back</button>
</div>

<!-- Admin login overlay -->
<div id="adminOverlay" class="adminOverlay">
  <h2>Admin Login</h2>
  <input type="password" id="adminPass" placeholder="Enter password">
  <button id="adminLoginBtn">Login</button>
</div>

<script type="module">
import { app, db, auth } from './firebaseConfig.js';
import { ref, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

// ---------- TOS ----------
const tosOverlay = document.getElementById('tosOverlay');
const acceptTOS = document.getElementById('acceptTOS');
const headerLogoContainer = document.getElementById('headerLogoContainer');
const appContent = document.getElementById('appContent');
if(localStorage.getItem('veltraTOSAccepted')==='true'){ showTOSOverlay(false); } else { showTOSOverlay(true); }
function showTOSOverlay(show){
  if(show){
    tosOverlay.style.display='flex';
    document.body.style.overflow='hidden';
    headerLogoContainer.classList.remove('visible');
    appContent.setAttribute('aria-hidden','true');
  } else {
    tosOverlay.style.display='none';
    document.body.style.overflow='';
    headerLogoContainer.classList.add('visible');
    appContent.setAttribute('aria-hidden','false');
  }
}
acceptTOS.addEventListener('click',()=>{
  localStorage.setItem('veltraTOSAccepted','true');
  showTOSOverlay(false);
});

// ---------- Bookmarks ----------
const grid = document.getElementById('grid');
const placeholder = document.getElementById('placeholder');
const catChipsContainer = document.getElementById('catChips');
const activeCountEl = document.getElementById('activeCount');
const clearCatsBtn = document.getElementById('clearCats');
const searchInput = document.getElementById('search');
const toast = document.getElementById('toast');
const toastText = document.getElementById('toastText');

let bookmarksData = [];
let selectedCategories = new Set();

async function fetchBookmarks(){
  const snap = await get(ref(db,'bookmarks'));
  if(snap.exists()){
    bookmarksData = Object.entries(snap.val()).map(([id,data])=>({id,...data}));
    renderCategories();
    renderGrid();
  } else {
    bookmarksData = [];
    renderGrid();
  }
}

function renderCategories(){
  const allCats = new Set();
  bookmarksData.forEach(b=>{ if(b.category) allCats.add(b.category); });
  catChipsContainer.innerHTML='';
  allCats.forEach(cat=>{
    const chip = document.createElement('div');
    chip.className='cat-chip';
    chip.textContent = cat;
    chip.addEventListener('click',()=>{ toggleCategory(cat,chip); });
    catChipsContainer.appendChild(chip);
  });
}

function toggleCategory(cat, chipEl){
  if(selectedCategories.has(cat)){
    selectedCategories.delete(cat);
    chipEl.classList.remove('selected');
  } else {
    selectedCategories.add(cat);
    chipEl.classList.add('selected');
  }
  updateActiveCount();
  renderGrid();
}

function updateActiveCount(){
  activeCountEl.textContent = selectedCategories.size ? Array.from(selectedCategories).join(', ') : 'All';
}

function renderGrid(){
  grid.innerHTML='';
  const searchTerm = searchInput.value.toLowerCase();
  const filtered = bookmarksData.filter(b=>{
    const matchesCategory = selectedCategories.size===0 || selectedCategories.has(b.category);
    const matchesSearch = b.title.toLowerCase().includes(searchTerm) || (b.desc && b.desc.toLowerCase().includes(searchTerm));
    return matchesCategory && matchesSearch;
  });

  if(filtered.length===0){ placeholder.style.display='block'; return; } else { placeholder.style.display='none'; }

  filtered.forEach(b=>{
    const card = document.createElement('div'); 
    card.className='card';
    card.innerHTML = `
      <div class="card-head">
        <div class="titleSmall">${b.title}</div>
        ${b.category ? `<div class="catTag">${b.category}</div>` : ''}
      </div>
      <div class="desc">${b.desc||''}</div>
      <div class="actions">
        <div class="copy-square" title="Copy bookmarklet">
          <img src="https://cdn-icons-png.flaticon.com/512/60/60752.png" alt="Copy">
        </div>
      </div>
    `;
    card.querySelector('.copy-square').addEventListener('click',()=>copyBookmark(b.code||''));
    grid.appendChild(card);
  });
}

function copyBookmark(code){
  navigator.clipboard.writeText(code).then(()=>{
    toastText.textContent='Copied!';
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'),1500);
  });
}

searchInput.addEventListener('input', renderGrid);
clearCatsBtn.addEventListener('click', ()=>{
  selectedCategories.clear();
  document.querySelectorAll('.cat-chip.selected').forEach(el=>el.classList.remove('selected'));
  updateActiveCount();
  renderGrid();
});

(async()=>{ await fetchBookmarks(); })();

// ---------- Instructions overlay ----------
const instructionsOverlay = document.getElementById('instructionsOverlay');
const instructionsBtn = document.getElementById('instructionsBtn');
const closeInstructions = document.getElementById('closeInstructions');
instructionsBtn.addEventListener('click',()=>instructionsOverlay.classList.add('show'));
closeInstructions.addEventListener('click',()=>instructionsOverlay.classList.remove('show'));

// ---------- Admin overlay ----------
const lockBtn = document.getElementById('lockBtn');
const adminOverlay = document.getElementById('adminOverlay');
const adminLoginBtn = document.getElementById('adminLoginBtn');
lockBtn.addEventListener('click',()=>adminOverlay.classList.add('show'));
adminLoginBtn.addEventListener('click',()=>{
  const pass = document.getElementById('adminPass').value;
  if(pass==='YOUR_ADMIN_PASSWORD'){
    alert('Admin access granted');
    adminOverlay.classList.remove('show');
  } else { alert('Incorrect password'); }
});
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Veltra — Bookmark Catalog</title>
<style>
:root{
  --bg:#000; --text:#fff; --muted:rgba(255,255,255,0.65);
  --border:rgba(255,255,255,0.12); --glow:rgba(255,255,255,0.12);
  --card-bg:rgba(255,255,255,0.02);
  --accent:#9be6a7;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif;}
a{color:var(--text);text-decoration:underline;cursor:pointer;}
.container{max-width:1100px;margin:18px auto;padding:14px;}
.header{display:flex;align-items:center;gap:12px;padding:8px 0;position:relative;z-index:2;}
.logo{width:48px;height:48px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .8s ease;}
.logo.visible{opacity:1;}
.logo img{width:100%;height:100%;object-fit:contain;}
.title{font-size:20px;font-weight:600;}
.tag{color:var(--muted);font-size:13px;margin-top:2px;}
.controls{margin-left:auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.search,.btn{background:transparent;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;}
.search::placeholder{color:var(--muted);}
.search:focus,.btn:focus{outline:none;box-shadow:0 0 8px var(--glow);}
.top-controls{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-top:10px;flex-wrap:wrap;}
.filter-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.small{font-size:13px;color:var(--muted);}
.cat-chips{display:flex;gap:8px;flex-wrap:wrap;}
.cat-chip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);cursor:pointer;background:transparent;color:var(--text);font-size:13px;}
.cat-chip.selected{box-shadow:0 0 8px var(--glow);transform:translateY(-2px);border-color:var(--accent);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin-top:14px;}
.card{border:1px solid var(--border);padding:12px;border-radius:10px;background:var(--card-bg);transition: transform .18s ease, box-shadow .18s ease;}
.card:hover{transform: translateY(-6px) scale(1.01);box-shadow:0 10px 30px var(--glow);}
.card-head{display:flex;justify-content:space-between;align-items:center;gap:8px;}
.titleSmall{font-weight:600;}
.catTag{font-size:12px;padding:6px;border-radius:8px;border:1px solid var(--border);color:var(--text);background:transparent;}
.desc{color:var(--muted);font-size:13px;margin:8px 0;min-height:38px;}
.actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.copy-square{width:44px;height:44px;border-radius:8px;border:1px solid var(--border);display:inline-flex;align-items:center;justify-content:center;cursor:pointer;background:transparent;color:var(--text);}
.copy-square img{width:22px;height:22px;object-fit:contain;}
.copy-square:hover{box-shadow:0 0 10px var(--glow);transform:translateY(-2px);}
.credit-link{font-size:13px;padding:6px 10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--muted);text-decoration:underline;}
.credit-link:hover{color:var(--text);box-shadow:0 0 8px var(--glow);}
.toast{position:fixed;left:50%;transform:translateX(-50%);top:14px;padding:12px 18px;border-radius:999px;background:#0b0b0b;color:#fff;box-shadow:0 10px 30px rgba(255,255,255,0.06);z-index:999;opacity:0;pointer-events:none;transition:opacity 0.3s;}
.toast.show{opacity:1;pointer-events:auto;}
@media (max-width:700px){
  .grid{grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;}
}
</style>
</head>
<body>

<!-- Main app -->
<div class="container" id="mainApp">
  <div class="header">
    <div class="logo" id="headerLogoContainer"><img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/main/black-and-white-geometric-logos-1%20(1).png" alt="Veltra Logo"></div>
    <div>
      <div class="title">Veltra</div>
      <div class="tag">Bookmarks & bookmarklets — clean & quick</div>
    </div>
    <div class="controls">
      <input id="search" class="search" placeholder="Search... (press Enter)">
      <button id="instructionsBtn" class="btn">Instructions</button>
    </div>
  </div>

  <div class="top-controls">
    <div class="filter-row">
      <div class="small">Filter categories:</div>
      <div id="catChips" class="cat-chips"></div>
    </div>
    <div class="controls-row">
      <div class="small">Selected: <span id="activeCount">All</span></div>
      <button id="clearCats" class="btn">Clear</button>
    </div>
  </div>

  <div id="grid" class="grid" aria-live="polite"></div>
</div>

<!-- Admin Lock Button -->
<button id="lockBtn" title="Admin" style="position:fixed;top:16px;right:16px;width:40px;height:40px;border-radius:8px;padding:6px;border:1px solid var(--border);background:transparent;cursor:pointer;opacity:0.95;z-index:1000;">
  <img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/main/lock-icon-clipart-free-png%20(1).webp" alt="lock" style="width:100%;height:100%;object-fit:contain;">
</button>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite"><span id="toastText"></span></div>

<!-- TOS Overlay -->
<div id="tosOverlay" aria-modal="true" role="dialog" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.96);color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:2000;padding:24px;overflow:auto;opacity:0;pointer-events:none;transition:opacity 0.3s;">
  <div class="overlay-content" style="max-width:900px;text-align:left;font-size:16px;line-height:1.45;color:var(--text);">
    <h2>Veltra — Terms of Service & Privacy Policy</h2>
    <p><strong>Last updated: October 29, 2025</strong></p>
    <p>Welcome to Veltra (“we,” “our,” or “us”). By accessing this website, you agree to our Terms of Service and Privacy Policy. Please read carefully.</p>
    <ol>
      <li><strong>Educational Use Only</strong> — For learning purposes only.</li>
      <li><strong>No Responsibility</strong> — Use at your own risk.</li>
      <li><strong>Redistribution Notice</strong> — We only share public content.</li>
      <li><strong>User Responsibilities</strong> — Follow applicable laws; no misuse.</li>
      <li><strong>No Warranty</strong> — Materials are "as is".</li>
      <li><strong>Intellectual Property</strong> — Respect original creators.</li>
      <li><strong>Links to Other Websites</strong> — We are not responsible for external sites.</li>
      <li><strong>Changes to Terms</strong> — Updates may occur anytime.</li>
      <li><strong>Support</strong> — Use our support page for issues.</li>
    </ol>
    <div style="text-align:center"><button id="acceptTOS" class="btn" style="margin-top:16px;">I Accept</button></div>
  </div>
</div>

<!-- Admin Overlay -->
<div id="adminOverlay" aria-modal="true" role="dialog" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.96);color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:2000;padding:24px;overflow:auto;opacity:0;pointer-events:none;transition:opacity 0.3s;">
  <div class="overlay-content" style="max-width:500px;text-align:left;">
    <h2>Admin Login</h2>
    <input id="adminEmail" placeholder="admin@example.com" style="width:100%;margin-top:12px;padding:8px;border-radius:6px;border:1px solid #444;background:transparent;color:#fff;">
    <input id="adminPass" type="password" placeholder="password" style="width:100%;margin-top:8px;padding:8px;border-radius:6px;border:1px solid #444;background:transparent;color:#fff;">
    <div style="margin-top:12px;">
      <button id="adminLoginBtn" class="btn">Login</button>
      <button id="closeAdmin" class="btn" style="margin-left:8px;">Close</button>
    </div>
    <p id="adminMsg" style="color:var(--muted);margin-top:10px;font-size:14px;"></p>
  </div>
</div>

<!-- Instructions Overlay -->
<div id="instructionsOverlay" aria-modal="true" role="dialog" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.96);color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:2000;padding:24px;overflow:auto;opacity:0;pointer-events:none;transition:opacity 0.3s;">
  <div class="overlay-content" style="max-width:900px;text-align:left;font-size:16px;line-height:1.45;color:var(--text);">
    <h2>How to add a Veltra bookmarklet</h2>
    <ol>
      <li>Copy the bookmarklet code using the Copy button.</li>
      <li>Open your browser and make sure bookmarks bar is visible.</li>
      <li>Add a new bookmark and paste the code as URL.</li>
      <li>Click the bookmarklet to use.</li>
    </ol>
    <div style="text-align:center"><button id="closeInstructions" class="btn" style="margin-top:16px;">Back</button></div>
  </div>
</div>

<script type="module">
import { app, db, auth } from './firebase-config.js';
import { ref, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

/* Elements */
const tosOverlay = document.getElementById('tosOverlay');
const acceptTOS = document.getElementById('acceptTOS');
const mainApp = document.getElementById('mainApp');
const headerLogoContainer = document.getElementById('headerLogoContainer');

const adminOverlay = document.getElementById('adminOverlay');
const lockBtn = document.getElementById('lockBtn');
const closeAdminBtn = document.getElementById('closeAdmin');
const adminLoginBtn = document.getElementById('adminLoginBtn');
const adminEmailInput = document.getElementById('adminEmail');
const adminPassInput = document.getElementById('adminPass');
const adminMsg = document.getElementById('adminMsg');

const instructionsOverlay = document.getElementById('instructionsOverlay');
const instructionsBtn = document.getElementById('instructionsBtn');
const closeInstructions = document.getElementById('closeInstructions');

const grid = document.getElementById('grid');
const catChipsContainer = document.getElementById('catChips');
const searchInput = document.getElementById('search');
const toast = document.getElementById('toast');
const toastText = document.getElementById('toastText');

/* Show Logo Animation */
setTimeout(()=>{headerLogoContainer.classList.add('visible')},100);

/* Toast helper */
function showToast(msg){
  toastText.textContent = msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),2000);
}

/* TOS */
if(!localStorage.getItem('acceptedTOS')) tosOverlay.style.opacity='1', tosOverlay.style.pointerEvents='auto';
acceptTOS.onclick=()=>{
  localStorage.setItem('acceptedTOS','1');
  tosOverlay.style.opacity='0'; tosOverlay.style.pointerEvents='none';
};

/* Admin login overlay */
lockBtn.onclick=()=>{adminOverlay.style.opacity='1'; adminOverlay.style.pointerEvents='auto';};
closeAdminBtn.onclick=()=>{adminOverlay.style.opacity='0'; adminOverlay.style.pointerEvents='none';};
adminLoginBtn.onclick=async()=>{
  const email = adminEmailInput.value;
  const pass = adminPassInput.value;
  try{
    await signInWithEmailAndPassword(auth,email,pass);
    showToast('Admin logged in');
    adminOverlay.style.opacity='0';
  }catch(e){
    adminMsg.textContent = 'Invalid credentials';
  }
};

/* Instructions overlay */
instructionsBtn.onclick=()=>{instructionsOverlay.style.opacity='1'; instructionsOverlay.style.pointerEvents='auto';};
closeInstructions.onclick=()=>{instructionsOverlay.style.opacity='0'; instructionsOverlay.style.pointerEvents='none';};

/* Fetch bookmarks */
const bookmarksRef = ref(db,'bookmarks/');
let allBookmarks = [];
get(bookmarksRef).then(snapshot=>{
  if(snapshot.exists()){
    allBookmarks = Object.values(snapshot.val());
    renderBookmarks(allBookmarks);
    renderCategories(allBookmarks);
  }
});

function renderBookmarks(items){
  grid.innerHTML='';
  items.forEach(b=>{
    const card = document.createElement('div'); card.className='card';
    const head = document.createElement('div'); head.className='card-head';
    const title = document.createElement('div'); title.className='titleSmall'; title.textContent=b.title;
    const catTag = document.createElement('div'); catTag.className='catTag'; catTag.textContent=b.categories?.join(', ')||'General';
    head.append(title,catTag);

    const desc = document.createElement('div'); desc.className='desc'; desc.textContent=b.desc||'No description';
    
    const actions = document.createElement('div'); actions.className='actions';
    const copyBtn = document.createElement('div'); copyBtn.className='copy-square'; copyBtn.title='Copy Code';
    copyBtn.innerHTML='<img src="https://img.icons8.com/material-outlined/24/copy.png"/>';
    copyBtn.onclick=()=>{navigator.clipboard.writeText(b.code||''); showToast('Copied!');};
    
    const useBtn = document.createElement('a'); useBtn.href=b.url||'#'; useBtn.className='btn'; useBtn.textContent='Use';
    useBtn.target='_blank';
    
    const credit = document.createElement('a'); credit.href=b.creditsLink||'#'; credit.target='_blank'; credit.className='credit-link'; credit.textContent='Credits';
    
    actions.append(copyBtn,useBtn,credit);
    card.append(head,desc,actions);
    grid.append(card);
  });
}

/* Categories */
function renderCategories(items){
  const cats = new Set(); items.forEach(b=>b.categories?.forEach(c=>cats.add(c)));
  cats.forEach(c=>{
    const chip = document.createElement('div'); chip.className='cat-chip'; chip.textContent=c;
    chip.onclick=()=>filterCategory(c,chip);
    catChipsContainer.append(chip);
  });
}
let activeCat='';
function filterCategory(c,chip){
  if(activeCat===c){activeCat='';chip.classList.remove('selected'); renderBookmarks(allBookmarks); return;}
  activeCat=c;
  document.querySelectorAll('.cat-chip').forEach(ch=>ch.classList.remove('selected'));
  chip.classList.add('selected');
  renderBookmarks(allBookmarks.filter(b=>b.categories?.includes(c)));
}

/* Search */
searchInput.addEventListener('keypress',e=>{if(e.key==='Enter'){const q=e.target.value.toLowerCase();renderBookmarks(allBookmarks.filter(b=>b.title.toLowerCase().includes(q)||b.desc.toLowerCase().includes(q)))}});

</script>

</body>
</html>

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Veltra</title>
<style>
:root{
  --bg:#000; --text:#fff; --muted:rgba(255,255,255,0.65);
  --border:rgba(255,255,255,0.12); --glow:rgba(255,255,255,0.12);
  --card-bg:rgba(255,255,255,0.02);
}
html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--text);font-family:Inter,sans-serif;}
a{color:var(--text);text-decoration:underline;cursor:pointer;}
.container{max-width:1100px;margin:18px auto;padding:14px;}
.header{display:flex;align-items:center;gap:12px;padding:8px 0;position:relative;z-index:2;}
.logo{width:48px;height:48px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .8s ease;}
.logo.visible{opacity:1;}
.logo img{width:100%;height:100%;object-fit:contain;}
.title{font-size:20px;font-weight:600;}
.tag{color:var(--muted);font-size:13px;margin-top:2px;}
.controls{margin-left:auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.search,.btn{background:transparent;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;}
.search::placeholder{color:var(--muted);}
.search:focus,.btn:focus{outline:none;box-shadow:0 0 8px var(--glow);}
.top-controls{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-top:10px;flex-wrap:wrap;}
.filter-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.small{font-size:13px;color:var(--muted);}
.cat-chips{display:flex;gap:8px;flex-wrap:wrap;}
.cat-chip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);cursor:pointer;background:transparent;color:var(--text);font-size:13px;}
.cat-chip.selected{box-shadow:0 0 8px var(--glow);transform:translateY(-2px);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin-top:14px;}
.card{border:1px solid var(--border);padding:12px;border-radius:10px;background:var(--card-bg);transition: transform .18s ease, box-shadow .18s ease;}
.card:hover{transform: translateY(-6px) scale(1.01);box-shadow:0 10px 30px var(--glow);}
.card-head{display:flex;justify-content:space-between;align-items:center;gap:8px;}
.titleSmall{font-weight:600;}
.catTag{font-size:12px;padding:6px;border-radius:8px;border:1px solid var(--border);color:var(--text);background:transparent;}
.desc{color:var(--muted);font-size:13px;margin:8px 0;min-height:38px;}
.actions{display:flex;gap:8px;align-items:center;}
.copy-square{width:44px;height:44px;border-radius:8px;border:1px solid var(--border);display:inline-flex;align-items:center;justify-content:center;cursor:pointer;background:transparent;color:var(--text);}
.copy-square img{width:20px;height:20px;}
.copy-square:hover{box-shadow:0 0 10px var(--glow);transform:translateY(-2px);}
.toast{position:fixed;left:50%;transform:translateX(-50%);top:14px;padding:12px 18px;border-radius:999px;background:#000;color:#fff;box-shadow:0 10px 30px rgba(255,255,255,0.12);z-index:999;opacity:0;pointer-events:none;transition:opacity 0.3s;}
.toast.show{opacity:1;}
#lockBtn{position:fixed;top:16px;right:16px;width:40px;height:40px;border-radius:8px;padding:6px;border:1px solid var(--border);background:transparent;cursor:pointer;opacity:0.8;z-index:1000;}
#lockBtn img{width:100%;height:100%;}
#instructionsOverlay, #tosOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);color:#fff;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:2000;padding:40px;overflow:auto;opacity:0;pointer-events:none;transition:opacity 0.4s ease;
}
.showOverlay{opacity:1;pointer-events:auto;}
.overlay-content{max-width:800px;text-align:left;font-size:18px;}
.backBtn{margin-top:20px;padding:10px 16px;font-size:16px;border:1px solid var(--border);background:transparent;color:#fff;border-radius:8px;cursor:pointer;}
.placeholder{text-align:center;padding:40px;color:var(--muted);grid-column:1/-1;border-radius:12px;border:1px solid rgba(255,255,255,0.02);}
</style>
</head>
<body>

<!-- TOS -->
<div id="tosOverlay">
  <div class="overlay-content" style="text-align:center">
    <h2>Veltra — Terms of Service & Privacy Policy</h2>
    <p>Welcome to Veltra! Before using our site, please read this carefully.</p>
    <p><strong>We collect minimal data</strong> (like your bookmarks and basic usage info) to make the experience better. By continuing, you agree to our TOS and Privacy Policy.</p>
    <p>We are not responsible for misuse of bookmarklets or links shared through this site.</p>
    <button id="acceptTOS" class="backBtn">I Accept</button>
  </div>
</div>

<!-- Main UI -->
<div class="container" id="mainApp" style="display:none;">
  <div class="header">
    <div class="logo" id="headerLogoContainer"><img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/main/black-and-white-geometric-logos-1%20(1).png" alt="Logo"></div>
    <div>
      <div class="title">Veltra</div>
      <div class="tag">Bookmarks & bookmarklets — clean & quick</div>
    </div>
    <div class="controls">
      <input id="search" class="search" placeholder="Search...">
      <button id="instructionsBtn" class="btn">Instructions</button>
    </div>
  </div>

  <div class="top-controls">
    <div class="filter-row">
      <div class="small">Filter categories:</div>
      <div id="catChips" class="cat-chips"></div>
    </div>
    <div class="controls-row">
      <div class="small">Selected: <span id="activeCount">All</span></div>
      <button id="clearCats" class="btn">Clear</button>
    </div>
  </div>

  <div id="grid" class="grid"></div>
  <div id="placeholder" class="placeholder" style="display:none;">No bookmarks match.</div>
</div>

<button id="lockBtn"><img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/main/lock-icon-clipart-free-png%20(1).webp"></button>
<div id="toast" class="toast"><span id="toastText"></span></div>

<!-- Instructions -->
<div id="instructionsOverlay">
  <div class="overlay-content">
    <h2>How to Use Veltra Bookmarklets (Safari)</h2>
    <ol>
      <li>Open Safari on your Mac or iPad.</li>
      <li>Click the <strong>Share</strong> button and choose <em>Add Bookmark</em>.</li>
      <li>Save it in the <strong>Favorites</strong> or <strong>Bookmarks Bar</strong>.</li>
      <li>After saving, open <strong>Edit Bookmarks</strong> and paste the copied code into the URL field.</li>
      <li>Now you can click that bookmark anytime to run the code!</li>
    </ol>
  </div>
  <button id="closeInstructions" class="backBtn">Back</button>
</div>

<script type="module">
import { app, db } from './firebase-config.js';
import { ref, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

// --- TOS ---
const tosOverlay=document.getElementById('tosOverlay');
const mainApp=document.getElementById('mainApp');
const acceptTOS=document.getElementById('acceptTOS');
if(localStorage.getItem('veltraTOSAccepted')==='true')showMain();else showTOS();
function showTOS(){tosOverlay.classList.add('showOverlay');}
function showMain(){tosOverlay.classList.remove('showOverlay');mainApp.style.display='block';document.getElementById('headerLogoContainer').classList.add('visible');}
acceptTOS.onclick=()=>{localStorage.setItem('veltraTOSAccepted','true');showMain();};

// --- Fetch bookmarks ---
const grid=document.getElementById('grid');
const placeholder=document.getElementById('placeholder');
const catChips=document.getElementById('catChips');
const activeCount=document.getElementById('activeCount');
const search=document.getElementById('search');
const toast=document.getElementById('toast');
const toastText=document.getElementById('toastText');

let data=[];let selected=new Set();

async function load(){
  const snap=await get(ref(db,'bookmarks'));
  if(snap.exists()){data=Object.entries(snap.val()).map(([id,v])=>({id,...v}));renderCats();render();}
}
function renderCats(){
  const cats=new Set();
  data.forEach(b=>b.categories&&Object.keys(b.categories).forEach(c=>cats.add(c)));
  catChips.innerHTML='';
  cats.forEach(c=>{
    const chip=document.createElement('div');
    chip.className='cat-chip';chip.textContent=c;
    chip.onclick=()=>{if(selected.has(c))selected.delete(c);else selected.add(c);render();updateCount();chip.classList.toggle('selected');};
    catChips.appendChild(chip);
  });
}
function updateCount(){activeCount.textContent=selected.size?Array.from(selected).join(', '):'All';}
function render(){
  grid.innerHTML='';
  const term=search.value.toLowerCase();
  const filtered=data.filter(b=>{
    const cat=selected.size===0||Object.keys(b.categories||{}).some(k=>selected.has(k));
    const text=b.title.toLowerCase().includes(term)||(b.desc||'').toLowerCase().includes(term);
    return cat&&text;
  });
  if(!filtered.length){placeholder.style.display='block';return;}else placeholder.style.display='none';
  filtered.forEach(b=>{
    const el=document.createElement('div');
    el.className='card';
    el.innerHTML=`<div class="card-head"><div class="titleSmall">${b.title}</div><div class="catTag">${Object.keys(b.categories||{}).join(', ')}</div></div>
      <div class="desc">${b.desc||''}</div>
      <div class="actions"><div class="copy-square"><img src="https://raw.githubusercontent.com/mojhehh/Ihateschool/main/pngtree-vector-copy-icon-png-image_4162801.jpg"></div></div>`;
    el.querySelector('.copy-square').onclick=()=>copyCode(b.code);
    grid.appendChild(el);
  });
}
function copyCode(code){
  navigator.clipboard.writeText(code).then(()=>{
    toastText.innerHTML=`✅ Copied — check our <span id="toastLink" style="text-decoration:underline;cursor:pointer;">Instructions</span>`;
    toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),3000);
    document.getElementById('toastLink').onclick=()=>openInstructions();
  });
}
search.oninput=render;
document.getElementById('clearCats').onclick=()=>{selected.clear();updateCount();document.querySelectorAll('.cat-chip').forEach(c=>c.classList.remove('selected'));render();}
load();

// --- Instructions overlay ---
const instructions=document.getElementById('instructionsOverlay');
const openBtn=document.getElementById('instructionsBtn');
const closeBtn=document.getElementById('closeInstructions');
function openInstructions(){instructions.classList.add('showOverlay');}
function closeInstructionsF(){instructions.classList.remove('showOverlay');}
openBtn.onclick=openInstructions;
closeBtn.onclick=closeInstructionsF;
</script>
</body>
</html>
